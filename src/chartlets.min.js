!function(win){function parseAttr(elem,attr){var val=elem.getAttribute(attr);return val?val.replace(/, +/g,",").split(/ +/g):null}function parseAttrWithStrings(elem,attr){var val=elem.getAttribute(attr),regexToExtractOption=/([\w]*?:'(?:[^\\"\']+|\\.)*')|([\w]*?:[-\d\S\.]+)/g;return val?val.match(regexToExtractOption):null}function parseOpts(elem){var pairs,pair,opts,i;for(pairs=parseAttr(elem,"data-opts")||[],opts={},i=0;i<pairs.length;i++)pair=pairs[i].split(":"),opts[pair[0]]=pair[1];return opts}function parseOptsPairs(pairs){var pair,opts,i;for(opts={},i=0;i<pairs.length;i++)pair=pairs[i].split(":"),opts[pair[0]]=pair[1];return opts}function parseOptsWithStrings(elem,attr){var opts=parseAttrWithStrings(elem,attr);if(opts){var pair,optsObj,i;for(optsObj={},i=0;i<opts.length;i++)pair=opts[i].split(":"),optsObj[pair[0]]=isNaN(pair[1])?stripSingleQuotes(pair[1]):+pair[1];return optsObj}return opts}function parseSets(str){var i,j,sets=str.match(/\[[^\[]+\]/g)||[];for(i=0;i<sets.length;i++)for(sets[i]=sets[i].match(/[-\d\.]+/g),j=0;j<sets[i].length;j++)sets[i][j]=+sets[i][j];return sets}function parseSetsWithStrings(str){var i,j,sets=str.match(/\[[^\[]+\]/g)||[];for(i=0;i<sets.length;i++)for(sets[i]=sets[i].match(/('(?:[^\\"\']+|\\.)*')|([-\w\.]+)/g),j=0;j<sets[i].length;j++)sets[i][j]=isNaN(sets[i][j])?stripSingleQuotes(sets[i][j]):+sets[i][j];return sets}function stripSingleQuotes(str){return"'"==str[0]&&"'"==str[str.length-1]?str.substring(1,str.length-1):str}function isStacked(){return"stack"===opts.transform}function isFilled(){return void 0!==opts.fill}function getRange(sets,stacked){return stacked?computeStackRange(sets):computeRange(sets)}function computeRange(sets){var arr=Array.prototype.concat.apply([],sets);return("bar"===type||isStacked())&&arr.push(0),[Math.min.apply(null,arr),Math.max.apply(null,arr)]}function computeStackRange(sets){return computeRange(mergeSets(sets).concat(sets))}function parseColor(str){var color={r:0,g:0,b:0,a:1};return str.match(/#/)?color=parseHex(str):str.match(/rgb/)?color=parseRGB(str):str.match(/hsl/)&&(color=parseHSL(str)),color}function parseRGB(str){var c=str.match(/[\d\.]+/g);return{r:+c[0],g:+c[1],b:+c[2],a:+c[3]||1}}function parseHex(str){var n,c=str.match(/\w/g);return 3===c.length&&(c=[c[0],c[0],c[1],c[1],c[2],c[2]]),n=+("0x"+c.join("")),{r:(16711680&n)>>16,g:(65280&n)>>8,b:255&n,a:1}}function parseHSL(str){function hue2rgb(p,q,t){return 0>t&&(t+=1),t>1&&(t-=1),1/6>t?p+6*(q-p)*t:.5>t?q:2/3>t?p+(q-p)*(2/3-t)*6:p}var c,h,s,l,r,g,b,q,p,a;return c=str.match(/[\d\.]+/g),h=+c[0]/360,s=+c[1]/100,l=+c[2]/100,a=(+c[3]||1)/1,0===s?r=g=b=l:(q=.5>l?l*(1+s):l+s-l*s,p=2*l-q,r=hue2rgb(p,q,h+1/3),g=hue2rgb(p,q,h),b=hue2rgb(p,q,h-1/3)),{r:255*r,g:255*g,b:255*b,a:a}}function mixColor(startColor,endColor,ratio){return{r:(1-ratio)*startColor.r+ratio*endColor.r,g:(1-ratio)*startColor.g+ratio*endColor.g,b:(1-ratio)*startColor.b+ratio*endColor.b,a:ratio>=.5?endColor.a:startColor.a}}function sheerColor(color,n){return color.a*=n,color}function toRGBString(color){return"rgba("+[Math.round(color.r),Math.round(color.g),Math.round(color.b),color.a].join(",")+")"}function rotate(){rotated=!0,ctx.translate(width,0),ctx.rotate(Math.PI/2)}function getXStep(len){return(rotated?height:width)/(len-1)}function getXForIndex(idx,len){return idx*getXStep(len)}function getYForValue(val){var h=rotated?width:height;return h-h*((val-range[0])/(range[1]-range[0]))}function getXForValueAndRange(val,range){var w=rotated?height:width;return w*((val-range[0])/(range[1]-range[0]))}function getYForValueAndRange(val,range){var h=rotated?width:height;return h-h*((val-range[0])/(range[1]-range[0]))}function getZForValueAndRange(val,range){var d=width>height?width:height;return d/10*val/range[1]}function getSignedSetIndices(sets,j,s){var positiveSetIndecies=[],negativeSetIndecies=[];for(i=0;i<sets.length;i++)sets[i][j]>=0?positiveSetIndecies.push(i):negativeSetIndecies.push(i);return"undefined"==typeof s||"positive"==s?positiveSetIndecies:negativeSetIndecies}function sumSet(set){var i,n=0;for(i=0;i<set.length;i++)n+=set[i];return n}function sumY(sets,idx){var i,n=0;for(i=0;i<sets.length;i++)n+=sets[i][idx];return n}function sumYSigned(sets,i,j){var sIndex,signedSetIndices=getSignedSetIndices(sets,j,sets[i][j]>=0?"positive":"negative"),sum=0;for(sIndex=0;sIndex<signedSetIndices.length;sIndex++)signedSetIndices[sIndex]<=i&&(sum+=sets[signedSetIndices[sIndex]][j]);return sum}function mergeSets(sets){var i,set=[];for(i=0;i<sets[0].length;i++)set.push(sumY(sets,i));return set}function colorOf(idx){return colors[idx]||"#000"}function drawLineForSet(set,strokeStyle,lineWidth,fillStyle,offset){var x,y,step,i=0;for(step=getXStep(set.length),ctx.lineWidth=Math.min(3,lineWidth),ctx.lineJoin="round",ctx.beginPath(),ctx.strokeStyle=strokeStyle,ctx.moveTo(0,getYForValue(set[0]));++i<set.length;)x=getXForIndex(i,set.length),y=getYForValue(set[i]),isStacked()&&(opts.shape="straight"),drawLineSegment(set,i,x,y,step,opts.shape);if(fillStyle){if(ctx.fillStyle=fillStyle,offset)for(;--i>=0;)x=getXForIndex(i,offset.length),y=getYForValue(offset[i]),drawLineSegment(offset,i,x,y,step,opts.shape);else ctx.lineTo(x,getYForValue(0)),ctx.lineTo(0,getYForValue(0));ctx.fill()}else ctx.stroke()}function drawLineSegment(set,i,x,y,step,shape){var cx,cy;"smooth"===shape?(cx=getXForIndex(i-.5,set.length),cy=getYForValue(set[i-1]),ctx.bezierCurveTo(cx,cy,cx,y,x,y)):("step"===shape&&(ctx.lineTo(x-step/2,getYForValue(set[i-1])),ctx.lineTo(x-step/2,y)),ctx.lineTo(x,y))}function drawCapsForSet(set,capStyle,fillStyle,lineWidth){for(var x,y,w,i=-1;++i<set.length;)x=getXForIndex(i,set.length),y=getYForValue(set[i]),"square"===capStyle?(w=2.5*Math.max(2,lineWidth),drawRect(fillStyle,x-w/2,y+w/2,w,w)):(w=lineWidth+1,drawCircle(fillStyle,x,y,w))}function drawCircle(fillStyle,x,y,r){ctx.fillStyle=fillStyle,ctx.beginPath(),ctx.arc(x,y,r,2*Math.PI,!1),ctx.fill()}function drawRect(fillStyle,x,y,w,h){ctx.fillStyle=fillStyle,ctx.fillRect(x,y-h,w,h)}function drawAxis(){var x,y;if(!isNaN(+opts.axis)){for(x=0,y=Math.round(getYForValue(opts.axis)),ctx.lineWidth=1,ctx.lineJoin="round",ctx.strokeStyle="#bbb",ctx.moveTo(x,y);width>x;)ctx.lineTo(x+5,y),ctx.moveTo(x+8,y),x+=8;ctx.stroke()}}function drawXYAxisAt(v,axis){"undefined"==typeof axis&&(axis="x");var start,end;if(end="y"==axis?width:height,!isNaN(+v)){for(start=0,v=Math.round(v),ctx.lineWidth=1,ctx.lineJoin="round",ctx.strokeStyle="#bbb","x"==axis?ctx.moveTo(start,v):ctx.moveTo(v,start);end>start;)"x"==axis?(ctx.lineTo(start+5,v),ctx.moveTo(start+8,v)):(ctx.lineTo(v,start+5),ctx.moveTo(v,start+8)),start+=8;ctx.stroke()}}function drawAxisCalibrations(){var i,elem=ctx.canvas;if(calibrationsX=null!==elem.getAttribute("data-x-calibrations")?parseSetsWithStrings(elem.getAttribute("data-x-calibrations")):null,calibrationsY=null!==elem.getAttribute("data-y-calibrations")?parseSetsWithStrings(elem.getAttribute("data-y-calibrations")):null,calibrationsX||calibrationsY){ctx.save(),ctx.strokeStyle="rgba(0,0,0,0.8)",ctx.lineWidth=1,ctx.font="9px sans-serif",ctx.color="rgba(0,0,0,0.8)",opts.paddingLeft=+opts.paddingLeft||.07,opts.paddingTop=+opts.paddingTop||.07,opts.paddingRight=+opts.paddingRight||.07,opts.paddingBottom=+opts.paddingBottom||.07;var xStart=width*opts.paddingLeft,yStart=height*opts.paddingTop,xEnd=width*(1-opts.paddingRight),yEnd=height*(1-opts.paddingBottom);if(calibrationsX){for(calibrations=calibrationsX[0],ctx.textAlign="center",ctx.beginPath(),ctx.moveTo(xStart,yEnd),ctx.lineTo(xEnd,yEnd),i=0;i<calibrations.length;i++)ctx.moveTo(xStart+(xEnd-xStart)/(calibrations.length-1)*i||xStart,yEnd),ctx.lineTo(xStart+(xEnd-xStart)/(calibrations.length-1)*i||xStart,height*(1-opts.paddingBottom-.03)),ctx.strokeText(calibrations[i],xStart+(xEnd-xStart)/(calibrations.length-1)*i||xStart,1.07*yEnd);ctx.stroke(),ctx.closePath()}if(calibrationsY){for(calibrations=calibrationsY[0],ctx.textAlign="end",ctx.beginPath(),ctx.moveTo(xStart,yEnd),ctx.lineTo(xStart,yStart),i=calibrations.length-1;i>=0;i--)ctx.moveTo(xStart,yStart+(yEnd-yStart)/(calibrations.length-1)*i||yStart),ctx.lineTo(width*(.03+opts.paddingLeft),yStart+(yEnd-yStart)/(calibrations.length-1)*i||yStart),ctx.strokeText(calibrations[calibrations.length-i-1],.9*xStart,yStart+(yEnd-yStart)/(calibrations.length-1)*i||yStart);ctx.stroke(),ctx.closePath()}ctx.restore(),ctx.translate(width*opts.paddingLeft,height*opts.paddingTop),ctx.scale(1-opts.paddingLeft-opts.paddingRight,1-opts.paddingTop-opts.paddingBottom),ctx.globalCompositeOperation="destination-over"}}function drawAxisForRanges(xAxisRange,yAxisRange){("undefined"==typeof xAxisRange||"undefined"==typeof yAxisRange)&&console.error('Range parameters for function "drawAxisForRanges" not provided'),isNaN(+opts.xAxis)&&isNaN(+opts.yAxis)?isNaN(+opts.axis)||(drawXYAxisAt(getXForValueAndRange(+opts.axis,xAxisRange),"x"),drawXYAxisAt(getYForValueAndRange(+opts.axis,yAxisRange),"y")):(isNaN(+opts.xAxis)||drawXYAxisAt(getXForValueAndRange(+opts.xAxis,xAxisRange),"x"),isNaN(+opts.yAxis)||drawXYAxisAt(getYForValueAndRange(+opts.yAxis,yAxisRange),"y"))}function drawTextAlongArc(context,str,centerX,centerY,radius,angle){var s,len=str.length;context.save(),context.translate(centerX,centerY),context.rotate(-1*angle/2),context.rotate(-1*(angle/len)/2);for(var n=0;len>n;n++)context.rotate(angle/len),context.save(),context.translate(0,-1*radius),s=str[n],context.fillText(s,0,0),context.restore();context.restore()}function getPointOnCircle(center,radius,angle,offset){return{x:center.h-radius+(radius-Math.cos(angle)*radius*offset),y:center.k-radius+(radius-Math.sin(angle)*radius*offset)}}function drawCalibration(ctx,center,radius,angle,start,end,value,style,lineWidth,font){var toPoint=getPointOnCircle(center,radius,angle,start);if("tick"===value){var fromPoint=getPointOnCircle(center,radius,angle,end);ctx.beginPath(),ctx.lineWidth=lineWidth,ctx.fillStyle=style,ctx.strokeStyle=style,ctx.moveTo(fromPoint.x,fromPoint.y),ctx.lineTo(toPoint.x,toPoint.y),ctx.stroke(),ctx.closePath()}else ctx.font=font,ctx.fillStyle=style,ctx.textAlign="center",ctx.textBaseline="top",ctx.fillText(value,toPoint.x,toPoint.y)}function drawFilledArc(ctx,center,outerRadius,innerRadius,startAngel,endAngle,style){ctx.beginPath(),ctx.arc(center.h,center.k,outerRadius,startAngel,endAngle,!1),ctx.arc(center.h,center.k,innerRadius,endAngle,startAngel,!0),ctx.fillStyle=style,ctx.fill(),ctx.closePath()}function interpolate(a,b,idx,steps){return+a+(+b-+a)*(idx/steps)}function interpolateSet(a,b,n){var i,j,c=[a];for(i=0;i<a.length;i++)for(j=1;n>j;j++)c[j]||(c[j]=[]),c[j][i]=interpolate(a[i],b[i],j,n);return c.concat([b])}function interpolateSets(a,b,n){var i,c=[];for(i=0;i<a.length;i++)c.push(interpolateSet(a[i],b[i],n));return c}function Transition(elem,asets,bsets){function _render(){var set=[];for(j=0;j<interpolated.length;j++)set.push(interpolated[j][i]);Chartlets.update(elem,set),++i<=n&&animate(_render)}var i=1,j=0,n=8,interpolated=interpolateSets(asets,bsets,n);return asets.length?void animate(_render):Chartlets.update(elem,bsets)}function renderLineChart(){var i,set,strokeStyle,fillStyle,alphaMultiplier,offset;if(opts.zeroValueMapperFn)for(i=0;i<sets.length;i++){var set=sets[i];for(j=0;j<set.length;j++)0==set[j]&&(sets[i][j]=eval(opts.zeroValueMapperFn+"(set[j-1], set[j+1], j, set, sets);"))}for(drawAxis(),i=0;i<sets.length;i++)set=sets[i],strokeStyle=colorOf(i),isStacked()&&(set=mergeSets(sets.slice(0,i+1)),offset=i>0?mergeSets(sets.slice(0,i)):null),drawLineForSet(set,strokeStyle,opts.stroke||1.5,null,offset),(isStacked()||isFilled())&&(alphaMultiplier=opts.alpha||(isStacked()?1:.5),fillStyle=toRGBString(sheerColor(parseColor(strokeStyle),alphaMultiplier)),drawLineForSet(set,strokeStyle,0,fillStyle,offset)),opts.cap&&drawCapsForSet(set,opts.cap,strokeStyle,ctx.lineWidth)}function renderBarChart(){drawAxisCalibrations();var i,j,p,a,x,y,w,h,len;for("horiz"===opts.orient&&rotate(),drawAxis(),ctx.lineWidth=opts.stroke||1,ctx.lineJoin="miter",len=sets[0].length,i=0;i<sets.length;i++)for(j=0;len>j;j++)p=1,a=rotated?height:width,w=a/len/sets.length-p/sets.length*i-1,x=p/2+getXForIndex(j,len+1)+w*i+1,y=getYForValue(sets[i][j]),h=y-getYForValue(0)||!isNaN(opts.mapZeroValueTo)&&+opts.mapZeroValueTo||0,isStacked()&&(w=a/len-2,x=getXForIndex(j,len+1),y=getYForValue(sumYSigned(sets,i,j))),drawRect(colorOf(i),x,y,w,h)}function renderBarLineChart(){var elem=ctx.canvas,heightRatio=parseFloat(elem.getAttribute("data-height-ratio")||1),heightProportions=height/(heightRatio+1);height=Math.round(heightProportions*heightRatio);var barChartHeight=Math.round(heightProportions),defaultOpts=parseOptsWithStrings(elem,"data-opts")||{};sets=null!==elem.getAttribute("data-line-sets")?parseSets(elem.getAttribute("data-line-sets")):sets,opts=null!==parseAttr(elem,"data-line-opts")?parseOptsPairs(parseAttr(elem,"data-line-opts")||[]):opts,colors=themes[opts.theme]||parseAttr(elem,"data-line-colors")||parseAttr(elem,"data-colors")||themes[defaultOpts.theme]||themes.basic,range=parseAttr(elem,"data-line-range")||parseAttr(elem,"data-range")||getRange(sets,isStacked()),rotated=!1,renderLineChart(),defaultOpts.separator&&defaultOpts.separator&&drawRect(defaultOpts.separatorStyle||"#000",0,height,width,defaultOpts.separatorWidth&&defaultOpts.separatorWidth/2||.5),ctx=ctx.canvas.getContext("2d"),ctx.translate(0,height),height=barChartHeight,sets=parseSets(null!==elem.getAttribute("data-bar-sets")?elem.getAttribute("data-bar-sets"):elem.getAttribute("data-sets")),opts=null!==parseAttr(elem,"data-bar-opts")?parseOptsPairs(parseAttr(elem,"data-bar-opts")||[]):parseOpts(elem),colors=themes[opts.theme]||parseAttr(elem,"data-bar-colors")||parseAttr(elem,"data-colors")||themes[defaultOpts.theme]||themes.basic,range=parseAttr(elem,"data-bar-range")||parseAttr(elem,"data-range")||getRange(sets,isStacked()),rotated=!1,renderBarChart(),defaultOpts.separator&&defaultOpts.separator&&drawRect(defaultOpts.separatorStyle||"#000",0,defaultOpts.separatorWidth&&defaultOpts.separatorWidth/2||.5,width,defaultOpts.separatorWidth&&defaultOpts.separatorWidth/2)}function renderPieChart(){var i,x,y,r,a1,a2,set,sum;for(x=width/2,y=height/2,r=Math.min(x,y)-2,a1=1.5*Math.PI,a2=0,set=sets[0],sum=sumSet(set),i=0;i<set.length;i++)ctx.fillStyle=colorOf(i),ctx.beginPath(),a2=a1+set[i]/sum*2*Math.PI,ctx.arc(x,y,r,a1,a2,!1),ctx.lineTo(x,y),ctx.fill(),a1=a2}function renderScatterChart(){var i,colorRange,xSets,ySets,xAxisRange,yAxisRange,zAxisRange,textOpts,textStrokeOpts,elem=ctx.canvas;for(sets=null!==elem.getAttribute("data-sets")?parseSetsWithStrings(elem.getAttribute("data-sets")):null,colorRange=parseAttr(elem,"data-color-range")||!1,colorRange&&(colorRange[0]=parseColor(colorRange[0]),colorRange[1]=parseColor(colorRange[1])),textOpts=parseOptsWithStrings(elem,"data-text-opts"),textStrokeOpts=parseOptsWithStrings(elem,"data-text-stroke-opts"),xSets=[],ySets=[],zSets=[],i=0;i<sets.length;i++)xSets[i]=sets[i][0],ySets[i]=sets[i][1],"undefined"!=typeof sets[i][4]&&(zSets[i]=sets[i][4]);xAxisRange=parseAttr(elem,"data-range-x")||parseAttr(elem,"data-range")||getRange(xSets,isStacked()),yAxisRange=parseAttr(elem,"data-range-y")||parseAttr(elem,"data-range")||getRange(ySets,isStacked()),zSets.length>0&&(zAxisRange=parseAttr(elem,"data-range-z")||getRange(zSets,!1));var set,fillStyle,alphaMultiplier,offsetX,offsetY;for(drawAxisForRanges(xAxisRange,yAxisRange),i=0;i<sets.length;i++){set=sets[i];var x,y,z,alpha,fillColor=colors&&colorOf(i)||themes[opts.theme]||themes.basic||"#000";x=getXForValueAndRange(set[0],xAxisRange),y=getYForValueAndRange(set[1],yAxisRange),z=isNaN(opts.bubblesRadius)?set[4]&&zAxisRange?getZForValueAndRange(set[4],zAxisRange):isNaN(opts.bubblesDefaultRadius)?width/25:+opts.bubblesDefaultRadius:+opts.bubblesRadius,(opts.bubbles||opts.bubble)&&(alpha=opts.bubblesAlpha||opts.alphaBubble||opts.alpha||1,fillColor=set[3]||colorRange&&toRGBString(mixColor(colorRange[0],colorRange[1],+set[4]/zAxisRange[1]))||opts.bubblesFillColor||fillColor,fillStyle=toRGBString(sheerColor(parseColor(fillColor),alpha)),drawCircle(fillStyle,x,y,z)),ctx.textAlign="center",textStrokeOpts&&(offsetX=isNaN(textStrokeOpts.offsetX)?0:+textStrokeOpts.offsetX,offsetY=isNaN(textStrokeOpts.offsetY)?0:+textStrokeOpts.offsetY,alpha=textStrokeOpts.alpha||!1,fillColor=textStrokeOpts.color||"#FFF",ctx.fillStyle=alpha?toRGBString(sheerColor(parseColor(fillColor),alpha)):fillColor,ctx.font=textStrokeOpts.font||"10px sans-serif","undefined"!=typeof textStrokeOpts.maxWidth?ctx.fillText(set[2],x+offsetX,y+offsetY,textStrokeOpts.maxWidth):ctx.fillText(set[2],x+offsetX,y+offsetY)),alpha=!1,offsetX=0,offsetY=0,textOpts&&(offsetX=isNaN(textOpts.offsetX)?0:+textOpts.offsetX,offsetY=isNaN(textOpts.offsetY)?0:+textOpts.offsetY,alpha=textOpts.alpha||!1,fillColor=textOpts.color||set[3]||textOpts.defaulColor||colors&&colorOf(i)||opts.theme&&themes[opts.theme]||themes.basic||"#000"),ctx.fillStyle=alpha?toRGBString(sheerColor(parseColor(fillColor),alpha)):fillColor,ctx.font=textOpts&&textOpts.font||"10px sans-serif",set[2].indexOf("fn#")>-1?eval(set[2].replace("fn#","")+"(ctx, x + offsetX, y + offsetY, z);"):textOpts&&"undefined"!=typeof textOpts.maxWidth?ctx.fillText(set[2],x+offsetX,y+offsetY,textOpts.maxWidth):ctx.fillText(set[2],x+offsetX,y+offsetY)}}function renderGaugeChart(){var exposedObj={},elem=ctx.canvas,opts,areas,calibration,calibrations,range,width=elem.width,height=elem.height,i,j,gaugeDiameter,gaugeRadius,gaugeCenter,xMargin,tickValue,minorTickValue,gaugeShift,gaugeValueRadians,getShiftedRadians,getTarget,drawGauge,animateIt,animatedMove,animatedMovePosition;range=parseAttr(elem,"data-range")||[],range[0]=range&&!isNaN(range[0])?+range[0]:0,range[1]=range&&!isNaN(range[1])?+range[1]:100,opts=parseOptsWithStrings(elem,"data-opts"),areas=null!==elem.getAttribute("data-areas")?parseSetsWithStrings(elem.getAttribute("data-areas")):null,calibrations=null!==elem.getAttribute("data-calibrations")?parseSetsWithStrings(elem.getAttribute("data-calibrations")):null,opts.majorTicks=isNaN(opts.majorTicks)?10:+opts.majorTicks,opts.majorTicksWidth=isNaN(opts.majorTicksWidth)?2:+opts.majorTicksWidth,opts.majorTicksStyle=opts.majorTicksStyle||"rgba(0, 0, 0, 0.6)",opts.majorTicksLengthRatio=isNaN(opts.majorTicksLengthRatio)?.8:+opts.majorTicksLengthRatio,opts.minorTicks=opts.minorTicks&&!isNaN(opts.minorTicks)?+opts.minorTicks:!1,opts.minorTicksWidth=isNaN(opts.minorTicksWidth)?1:+opts.minorTicksWidth,opts.minorTicksStyle=opts.minorTicksStyle||"rgba(50, 50, 50, 0.8)",opts.minorTicksLengthRatio=isNaN(opts.minorTicksLengthRatio)?.82:+opts.minorTicksLengthRatio,opts.gaugeBackground=opts.gaugeBackground||"rgba(90, 100, 120, 0.5)",opts.calibrationRadiusRatio=isNaN(opts.calibrationRadiusRatio)?1:+opts.calibrationRadiusRatio,gaugeDiameter=isNaN(opts.widthRatio)?isNaN(opts.heightRatio)?.95*width:+opts.heightRatio*height:+opts.widthRatio*width,gaugeRadius=gaugeDiameter/2,xMargin=(width-gaugeDiameter)/2,gaugeCenter={h:width/2,k:.95*height},gaugeShift=.04*Math.PI,gaugeValueRadians=Math.PI-2*gaugeShift,tickValue=gaugeValueRadians/opts.majorTicks,minorTickValue=opts.minorTicks&&tickValue/(opts.minorTicks+1)||!1,getShiftedRadians=function(val){return val/range[1]*gaugeValueRadians+gaugeShift},getTarget=function(){return isNaN(opts.target)?range[0]:+opts.target>range[1]?range[1]:+opts.target>=range[0]?+opts.target:range[0]},drawGauge=function(shiftedRadTarget){if(ctx=elem.getContext("2d"),ctx.clearRect(0,0,width,height),drawFilledArc(ctx,gaugeCenter,width/2-xMargin,100>width?5:10,Math.PI,2*Math.PI,opts.gaugeBackground),areas){var endAngle,startAngel=Math.PI+gaugeShift;for(i=0;i<areas.length;i++){var set=areas[i],startPoint=getPointOnCircle(gaugeCenter,gaugeRadius,startAngel,.88);endAngle=Math.PI+getShiftedRadians(+set[0]);var endPoint=getPointOnCircle(gaugeCenter,gaugeRadius,endAngle,.88),areasRadius=isNaN(opts.areasRadiusRatio)?.18*gaugeRadius:.88*gaugeRadius*(1-+opts.areasRadiusRatio);if("undefined"!=typeof opts.gradientAreas&&"false"!=opts.gradientAreas){var grd=ctx.createLinearGradient(startPoint.x,startPoint.y,endPoint.x,endPoint.y);grd.addColorStop(0,set[1]),grd.addColorStop(.2,set[1]),grd.addColorStop(1,areas[i-1]&&areas[i-1][1]||opts.gaugeBackground),drawFilledArc(ctx,gaugeCenter,.88*gaugeRadius,areasRadius,startAngel,endAngle,grd)}else drawFilledArc(ctx,gaugeCenter,.88*gaugeRadius,areasRadius,startAngel,endAngle,set[1]);startAngel=endAngle}}for(i=0;i<opts.majorTicks+1;i++){var majorStep=i*tickValue+gaugeShift;if(drawCalibration(ctx,gaugeCenter,gaugeRadius,majorStep,.88,opts.majorTicksLengthRatio,"tick",opts.majorTicksStyle,opts.majorTicksWidth),"undefined"!=typeof opts.calibrate&&"false"!=opts.calibrate){var calibrationValue=calibrations&&"undefined"!=typeof calibrations[0][i]?calibrations[0][i]:Math.round(i==opts.majorTicks?range[1]:0==i?range[0]:range[1]/opts.majorTicks*i),font=opts.calibrationFont||"10px sans-serif",style=opts.calibrationStyle||"rgba(0, 0, 0, 0.9)";drawCalibration(ctx,gaugeCenter,gaugeRadius,majorStep,opts.calibrationRadiusRatio,opts.calibrationRadiusRatio-.1,calibrationValue,style,null,font)}if(minorTickValue&&i<opts.majorTicks)for(j=0;j<opts.minorTicks;j++)majorStep+=minorTickValue,drawCalibration(ctx,gaugeCenter,gaugeRadius,majorStep,.88,opts.minorTicksLengthRatio,"tick",opts.minorTicksStyle,opts.minorTicksWidth)}"undefined"!=typeof opts.title&&opts.title&&(ctx.textAlign="center",ctx.font=opts.titleFont||"10px sans-serif",ctx.fillStyle=opts.titleStyle||"#000",ctx.fillText(opts.title,gaugeCenter.h,gaugeCenter.k-.4*gaugeRadius,gaugeDiameter)),ctx.save(),ctx.translate(gaugeCenter.h,gaugeCenter.k),ctx.rotate(shiftedRadTarget-Math.PI/2),ctx.translate(-gaugeCenter.h,-gaugeCenter.k);var needleWidthRatio=isNaN(opts.needleWidthRatio)?1:+opts.needleWidthRatio;ctx.fillStyle=opts.needleFillStyle||"rgba(220, 60, 20, 0.6)",ctx.strokeStyle=opts.needleStrokeStyle||"rgba(200, 50, 20, 0.8)",ctx.beginPath(),ctx.moveTo(gaugeCenter.h,gaugeCenter.k-.88*gaugeRadius),ctx.bezierCurveTo(gaugeCenter.h+.04*gaugeRadius*needleWidthRatio,gaugeCenter.k-.4*gaugeRadius,gaugeCenter.h+.03*gaugeRadius*needleWidthRatio,gaugeCenter.k-.2*gaugeRadius,gaugeCenter.h+.02*gaugeRadius*needleWidthRatio,gaugeCenter.k),ctx.lineTo(gaugeCenter.h-.02*gaugeRadius*needleWidthRatio,gaugeCenter.k),ctx.bezierCurveTo(gaugeCenter.h-.03*gaugeRadius*needleWidthRatio,gaugeCenter.k-.2*gaugeRadius,gaugeCenter.h-.04*gaugeRadius*needleWidthRatio,gaugeCenter.k-.4*gaugeRadius,gaugeCenter.h,gaugeCenter.k-.88*gaugeRadius),ctx.fill(),ctx.stroke(),ctx.restore(),ctx.fillStyle=opts.needleBaseFillStyle||"rgba(200, 150, 40, 0.9)",ctx.strokeStyle=opts.needleBaseStrokeStyle||"rgba(220, 160, 30, 0.5)",ctx.beginPath();var needleBaseRadius=needleWidthRatio>.7?.12*gaugeRadius*needleWidthRatio:.12*gaugeRadius;ctx.arc(gaugeCenter.h,gaugeCenter.k,needleBaseRadius,.95*Math.PI,.05*Math.PI),ctx.fill(),ctx.stroke()},animateIt=win.requestAnimationFrame||win.webkitRequestAnimationFrame||win.mozRequestAnimationFrame||win.msRequestAnimationFrame||function(callback){win.setTimeout(callback,1e3/60)},animatedMove=function(){var delta=opts.target-animatedMovePosition;animatedMovePosition+=delta/10,animatedMovePosition!=getTarget()&&Math.abs(delta/range[1])>.05?(drawGauge(getShiftedRadians(animatedMovePosition)),animateIt(animatedMove)):drawGauge(getShiftedRadians(opts.target))},exposedObj.setTarget=function(val,doAnimate){animatedMovePosition=getTarget(),opts.target=isNaN(+val)?getTarget():+val,"undefined"==typeof doAnimate||doAnimate?animateIt(animatedMove):drawGauge(getShiftedRadians(opts.target))},exposedObj.getTarget=getTarget,exposedObj.setTitle=function(title){opts.title=title,drawGauge(getShiftedRadians(opts.target))},exposedObj.redraw=function(){drawGauge(getShiftedRadians(opts.target))},"undefined"!=typeof opts.objectName&&eval("win."+opts.objectName+"=exposedObj;"),drawGauge(getShiftedRadians(getTarget()))}function init(elem){win.devicePixelRatio>1&&(elem.__resized||(elem.style.width=elem.width+"px",elem.style.height=elem.height+"px",elem.width=2*elem.width,elem.height=2*elem.height,elem.__resized=!0)),type=parseAttr(elem,"data-type")[0],sets=null!==elem.getAttribute("data-sets")?parseSets(elem.getAttribute("data-sets")):null,opts=parseOpts(elem),ctx=elem.getContext("2d"),width=elem.width,height=elem.height,colors=themes[opts.theme]||parseAttr(elem,"data-colors")||themes.basic,range=parseAttr(elem,"data-range")||sets&&getRange(sets,isStacked())||null,rotated=!1,elem.width=elem.width,opts.bgcolor&&drawRect(opts.bgcolor||"#fff",0,0,width,-height);try{renderers[type](ctx,width,height,sets,opts)}catch(e){console.error(e.message)}}var Chartlets,type,ctx,width,height,rotated,range,sets,opts,colors,themes,renderers,animate;type=null,ctx=null,width=0,height=0,rotated=!1,range=[0,0],sets=[],opts={},renderers={line:renderLineChart,bar:renderBarChart,pie:renderPieChart,barline:renderBarLineChart,scatter:renderScatterChart,gauge:renderGaugeChart},themes={blues:["#7eb5d6","#2a75a9","#214b6b","#dfc184","#8f6048"],money:["#009b6d","#89d168","#d3eb87","#666666","#aaaaaa"],circus:["#9351a4","#ff99cc","#e31a1c","#66cdaa","#ffcc33"],party:["#ffcc00","#ff66cc","#3375cd","#e43b3b","#96cb3f"],garden:["#3c7bb0","#ffa07a","#2e8b57","#7eb5d6","#89d168"],crayon:["#468ff0","#ff8000","#00c000","#ffd700","#ff4500"],ocean:["#3375cd","#62ccb2","#4aa5d5","#a6cee3","#ffcc33"],spring:["#ed729d","#72caed","#9e9ac8","#a6d854","#f4a582"],beach:["#f92830","#2fb4b1","#ffa839","#3375cd","#5fd1d5"],fire:["#dc143c","#ff8c00","#ffcc33","#b22222","#cd8540"]},animate=win.requestAnimationFrame||win.webkitRequestAnimationFrame||win.mozRequestAnimationFrame||win.msRequestAnimationFrame||function(callback){win.setTimeout(callback,1e3/60)},Chartlets={render:function(elems){var i;for(elems||(elems=document.querySelectorAll(".chartlet")),i=0;i<elems.length;i++)init(elems[i])},setTheme:function(name,palette){themes[name]=palette},getTheme:function(name){return name?themes[name]:colors},setRenderer:function(type,renderer){renderers[type]=renderer},update:function(elem,sets,options){return"string"==typeof elem&&(elem=document.getElementById(elem)),options&&"linear"===options.transition?void new Transition(elem,parseSets(elem.getAttribute("data-sets")),sets):(elem.setAttribute("data-sets",JSON.stringify(sets)),void this.render([elem]))}},win.Chartlets=Chartlets}(window);